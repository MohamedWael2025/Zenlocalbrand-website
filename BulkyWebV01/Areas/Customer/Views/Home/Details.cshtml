@model ShoppingCart

<form method="post" class="zen-section">
    <input hidden asp-for="ProductId" />

    <!-- Breadcrumb -->
    <div style="margin-bottom: var(--zen-space-6);">
        <a asp-action="Index" class="zen-link">
            <i class="bi bi-arrow-left"></i> Back to Products
        </a>
    </div>

    <!-- Product Detail Grid -->
    <div class="zen-grid zen-grid-2" style="gap: var(--zen-space-12); align-items: start;">
        
        <!-- Product Images -->
        <div>
            @if (Model.Product.ProductImages != null && Model.Product.ProductImages.Count > 0)
            {
                <div class="zen-card" style="padding: 0; overflow: hidden;">
                    <img src="@Model.Product.ProductImages.FirstOrDefault().ImageUrl" 
                         id="zenMainImage" 
                         alt="@Model.Product.Title" 
                         style="width: 100%; aspect-ratio: 3/4; object-fit: cover; transition: opacity 0.3s;" />
                </div>
                
                @if (Model.Product.ProductImages.Count > 1)
                {
                    <div class="zen-flex zen-gap-3" style="margin-top: var(--zen-space-4);">
                        @foreach (var img in Model.Product.ProductImages)
                        {
                            <button type="button" 
                                    class="zen-card" 
                                    style="padding: 0; width: 80px; height: 100px; overflow: hidden; border: 2px solid var(--zen-border);"
                                    onclick="zenSwitchImage('@img.ImageUrl')">
                                <img src="@img.ImageUrl" 
                                     alt="Thumbnail" 
                                     style="width: 100%; height: 100%; object-fit: cover;" />
                            </button>
                        }
                    </div>
                }
            }
            else
            {
                <div class="zen-card" style="padding: 0; overflow: hidden;">
                    <img src="https://placehold.co/600x800/1a1a1a/6366f1/png?text=ZEN" 
                         alt="@Model.Product.Title" 
                         style="width: 100%; aspect-ratio: 3/4; object-fit: cover;" />
                </div>
            }
        </div>

        <!-- Product Info -->
        <div>
            <div class="zen-card">
                <span class="zen-eyebrow">@Model.Product.Category.Name</span>
                <h1 style="font-size: var(--zen-font-4xl); font-weight: 700; margin: var(--zen-space-3) 0;">
                    @Model.Product.Title
                </h1>
                <p style="color: var(--zen-text-secondary); margin-bottom: var(--zen-space-4);">
                    By @Model.Product.Author
                </p>

                @if (Model.Product.IsOutOfStock)
                {
                    <div class="zen-badge zen-badge-danger" style="font-size: var(--zen-font-base); padding: var(--zen-space-3) var(--zen-space-6);">
                        Out of Stock
                    </div>
                }

                <!-- Pricing -->
                <div style="margin: var(--zen-space-6) 0;">
                    @if (!Model.Product.IsOutOfStock)
                    {
                        @if (Model.Product.SalePrice.HasValue && Model.Product.SalePrice.Value > 0)
                        {
                            <div class="zen-price-group">
                                <span class="zen-price-old">@Model.Product.Price.ToString("N2") EGP</span>
                                <span class="zen-price" style="color: #ef4444;">@Model.Product.SalePrice.Value.ToString("N2") EGP</span>
                            </div>
                        }
                        else
                        {
                            <div class="zen-price-group">
                                <span class="zen-price-old">@Model.Product.ListPrice.ToString("N2") EGP</span>
                                <span class="zen-price">@Model.Product.Price.ToString("N2") EGP</span>
                            </div>
                        }
                    }
                </div>

                <!-- Sizes -->
                @if (!string.IsNullOrEmpty(Model.Product.AvailableSizes))
                {
                    <div style="margin: var(--zen-space-6) 0;">
                        <p style="font-weight: 600; margin-bottom: var(--zen-space-3);">Available Sizes:</p>
                        <div class="zen-size-selector">
                            @foreach (var size in Model.Product.AvailableSizes.Split(','))
                            {
                                <span class="zen-size-chip">@size.Trim()</span>
                            }
                        </div>
                    </div>
                }

                <!-- Description -->
                <div style="margin: var(--zen-space-6) 0; padding-top: var(--zen-space-6); border-top: 1px solid var(--zen-divider);">
                    <p style="color: var(--zen-text-secondary); line-height: var(--zen-leading-relaxed);">
                        @Html.Raw(Model.Product.Description)
                    </p>
                </div>

                <!-- Add to Cart -->
                @if (!Model.Product.IsOutOfStock)
                {
                    <div style="margin-top: var(--zen-space-8); padding-top: var(--zen-space-6); border-top: 1px solid var(--zen-divider);">
                        <div style="margin-bottom: var(--zen-space-4);">
                            <label style="display: block; font-weight: 600; margin-bottom: var(--zen-space-2);">
                                Quantity
                            </label>
                            <input asp-for="Count" 
                                   type="number" 
                                   value="1" 
                                   min="1" 
                                   class="zen-input" 
                                   style="max-width: 120px;" />
                        </div>
                        <button type="submit" class="zen-btn zen-btn-primary" style="width: 100%;">
                            <i class="bi bi-cart-plus"></i>
                            <span>Add to Cart</span>
                        </button>
                    </div>
                }
                else
                {
                    <div style="margin-top: var(--zen-space-8); padding: var(--zen-space-4); background: var(--zen-accent-light); border-radius: var(--zen-radius);">
                        <i class="bi bi-info-circle"></i>
                        This product is currently unavailable
                    </div>
                }
            </div>
        </div>
    </div>
</form>

<script>
function zenSwitchImage(url) {
    const img = document.getElementById('zenMainImage');
    img.style.opacity = '0';
    setTimeout(() => {
        img.src = url;
        img.style.opacity = '1';
    }, 300);
}
</script>
